<?xml version="1.0" encoding="utf-8"?>

<Patch>

	<Operation Class="PatchOperationSequence">
		<success>Normal</success>
		<operations>
	
	<!-- Anomaly Replacements (Patch items to use Anomaly DLC mechanics instead) -->
			
			<!-- Replace Healing Mechanites regeneration code with the one from the Anomaly DLC -->
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationRemove">
				<xpath>/Defs/HediffDef[defName = "FSFImplantMechanitesHealing"]/comps/li[@Class = "VEF.AnimalBehaviours.HediffCompProperties_Regeneration"]</xpath>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationAdd">
				<xpath>/Defs/HediffDef[defName = "FSFImplantMechanitesHealing"]</xpath>
				<value>
					<stages>
						<li>
							<regeneration>240</regeneration>
						</li>
					</stages>
				</value>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationReplace">
				<xpath>/Defs/HediffDef[defName = "FSFImplantMechanitesHealing"]/description</xpath>
				<value>
					<description>A dose of semi-coherent mechanites designed to rapidly heal injuries within the host.  They're so powerful they can regenerate scars, missing organs and lost limbs.\n\nFor ease-of-use the mechanites are designed to be self-installable via a small handheld injector.  Due to how mechanites work only one strain can exist harmoniously inside the host’s body.  Upon injection any existing strain will be eliminated by the newly injected mechanites.  It is possible to remove mechanite strains entirely from a host, however it requires an expensive and difficult surgery.</description>
				</value>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationReplace">
				<xpath>/Defs/ThingDef[defName = "FSFImplantMechanitesHealing"]/description</xpath>
				<value>
					<description>A dose of semi-coherent mechanites designed to rapidly heal injuries within the host.  They're so powerful they can regenerate scars, missing organs and lost limbs.\n\nFor ease-of-use the mechanites are designed to be self-installable via a small handheld injector.  Due to how mechanites work only one strain can exist harmoniously inside the host’s body.  Upon injection any existing strain will be eliminated by the newly injected mechanites.  It is possible to remove mechanite strains entirely from a host, however it requires an expensive and difficult surgery.</description>
				</value>
			</li>
			
			<!-- Replace Resurrection Core resurrection code with the one from the Anomaly DLC -->
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationRemove">
				<xpath>/Defs/HediffDef[defName = "FSFImplantTorsoResurrect"]/comps</xpath>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationAdd">
				<xpath>/Defs/HediffDef[defName = "FSFImplantTorsoResurrect"]</xpath>
				<value>
					<hediffClass>Hediff_DeathRefusal</hediffClass>
					<showGizmosOnCorpse>true</showGizmosOnCorpse>
				</value>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationReplace">
				<xpath>/Defs/HediffDef[defName = "FSFImplantTorsoResurrect"]/description</xpath>
				<value>
					<description>An installed resurrection core.  A small durable core which contains a one-use super-dose of mechanites tuned to resurrect the dead. After the host dies, the core will sustain their mind and, when they choose, rebuild their body. The flesh will rapidly reform, replacing missing organs and healing wounds. The process is not perfect and may cause scarring or other health complications.</description>
				</value>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationReplace">
				<xpath>/Defs/ThingDef[defName = "FSFImplantTorsoResurrect"]/description</xpath>
				<value>
					<description>A small durable core which contains a one-use super-dose of mechanites tuned to resurrect the dead. After the host dies, the core will sustain their mind and, when they choose, rebuild their body. The flesh will rapidly reform, replacing missing organs and healing wounds. The process is not perfect and may cause scarring or other health complications.</description>
				</value>
			</li>
			
			<!-- Replace Immortality Core code with the one from the Anomaly DLC -->
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationRemove">
				<xpath>/Defs/HediffDef[defName = "FSFArchotechImplantTorsoImmortal"]/comps</xpath>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationAdd">
				<xpath>/Defs/HediffDef[defName = "FSFArchotechImplantTorsoImmortal"]</xpath>
				<value>
					<preventsDeath>true</preventsDeath>
					<keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
					<stages>
						<li>
							<regeneration>240</regeneration>
						</li>
					</stages>
				</value>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationReplace">
				<xpath>/Defs/HediffDef[defName = "FSFArchotechImplantTorsoImmortal"]/description</xpath>
				<value>
					<description>An installed immortality core.  A small durable core of archotech design said to make its host immortal through rapid regeneration.  Its inner workings are a complete mystery, it’s unclear how it can endlessly regenerate a person seemingly from nothing.  Once implanted the core cannot be removed without damaging the device rendering it inert.</description>
				</value>
			</li>
			
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationReplace">
				<xpath>/Defs/ThingDef[defName = "FSFArchotechImplantTorsoImmortal"]/description</xpath>
				<value>
					<description>A small durable core of archotech design said to make its host immortal through rapid regeneration.  Its inner workings are a complete mystery, it’s unclear how it can endlessly regenerate a person seemingly from nothing.  Once implanted the core cannot be removed without damaging the device rendering it inert.</description>
				</value>
			</li>
	
		</operations>
	</Operation>
	
</Patch>